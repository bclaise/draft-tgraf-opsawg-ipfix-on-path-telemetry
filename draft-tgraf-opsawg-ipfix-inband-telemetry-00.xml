<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="1"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std" docName="draft-tgraf-opsawg-ipfix-inband-telemetry-00"
     ipr="trust200902">
  <front>
    <title abbrev="Export of Forwarding Path Delay in IPFIX">Export of
    Forwarding Path Delay in IPFIX</title>

    <author fullname="Thomas Graf" initials="T" surname="Graf">
      <organization>Swisscom</organization>

      <address>
        <postal>
          <street>Binzring 17</street>

          <city>Zurich</city>

          <code>8045</code>

          <country>Switzerland</country>
        </postal>

        <email>thomas.graf@swisscom.com</email>
      </address>
    </author>

    <author fullname="Benoit Claise" initials="B" surname="Claise">
      <organization>Huawei</organization>

      <address>
        <email>benoit.claise@huawei.com</email>
      </address>
    </author>

    <author fullname="Alex Huang Feng" initials="A." surname="Huang Feng">
      <organization>INSA-Lyon</organization>

      <address>
        <postal>
          <street/>

          <city>Lyon</city>

          <region/>

          <code/>

          <country>France</country>
        </postal>

        <phone/>

        <facsimile/>

        <email>alex.huang-feng@insa-lyon.fr</email>

        <uri/>
      </address>
    </author>

    <date day="23" month="June" year="2022"/>

    <abstract>
      <t>This document introduces new IP Flow Information Export (IPFIX)
      information elements to expose the Inband Telemtry measured forwarding
      path delay.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="Introduction" title="Introduction">
      <t>With Inband Telemetry, defined in <xref
      target="I-D.ietf-ippm-ioam-deployment">In-situ OAM</xref>, <xref
      target="I-D.filsfils-spring-path-tracing">Path Tracing</xref> and <xref
      target="I-D.song-opsawg-ifit-framework">In-situ Flow Information
      Telemetry</xref>, the path delay between two endpoints is measured by
      inserting a timestamp in the packet.</t>

      <t>Inband Telemetry can be distinguished between two modes. Passport
      mode where only the last hop in the forwarding path of the Inband
      Telemetry domain exposes all the metrics and postcard mode where the transit
      nodes also expose metrics. In both modes the forwarding path is exposed.
      Thus allowing to determine how much delay has been accumulated hop by hop.</t>

      <t>This document defines six new IPFIX Information Elements (IEs) with
      their coresponding entries in the performance metrics registry to expose
      the forwarding path delay.</t>

      <t>The delay is measured by calculating the difference between the
      timestamp imposed with Inband Telemetry in the packet at the first hop
      and the timestamp being used for the IPFIX flow record when being export
      on the receiving transit and decapsulation nodes. Depending on the IE,
      the lowest, highest or the sum of measured delay is being exported.</t>
    </section>

    <section anchor="IE" title="IPFIX Information Elements">
      <t>This section defines and describes the new IPFIX IEs.<list
          style="hanging">
          <t hangText="PathDelayMinDeltaMicroseconds"><vspace blankLines="0"/>
          16-bit unsigned integer that identifies the lowest path delay.</t>

          <t hangText="PathDelayMinDeltaNanoseconds"><vspace blankLines="0"/>
          32-bit unsigned integer that identifies the lowest path delay.</t>

          <t hangText="PathDelayMaxDeltaMicroseconds"><vspace blankLines="0"/>
          16-bit unsigned integer that identifies the highest path delay.</t>

          <t hangText="PathDelayMaxDeltaNanoseconds"><vspace blankLines="0"/>
          32-bit unsigned integer that identifies the highest path delay.</t>

          <t hangText="PathDelaySumDeltaMicroseconds"><vspace blankLines="0"/>
          32-bit unsigned integer that identifies the sum of the path
          delay.</t>

          <t hangText="PathDelaySumDeltaNanoseconds"><vspace blankLines="0"/>
          64-bit unsigned integer that identifies the sum of the path
          delay.</t>
        </list></t>
    </section>

    <section anchor="Use-Cases" title="Use Cases">
      <t>The measured forwarding path delay can be aggregated with Flow
      Aggregation as defined in <xref target="RFC7015"/> to the following
      device and control-plane dimensions to determine:</t>

      <t><list style="symbols">
          <t>With egressInterface(IE14), which logical egress interfaces have
          been contributing to how much delay.</t>

          <t>With egressPhysicalInterface(253), which physical egress
          interfaces have been contributing to how much delay.</t>

          <t>With ipNextHopIPv4Address(IE15) or ipNextHopIPv6Address(IE62),
          the forwarding path to which next-hop IP contributed to how much
          delay.</t>

          <t>With mplsTopLabelIPv4Address(IE47) or srhActiveSegmentIPv6 from
          <xref target="I-D.tgraf-opsawg-ipfix-srv6-srh"/>, the forwarding
          path to which MPLS top label IPv4 address or SRv6 active segment
          contributed to how much delay.</t>

          <t>BGP communities are often used for setting a path priority or
          service selection. With bgpDestinationExtendedCommunityList(488) or
          bgpDestinationCommunityList(485) or
          bgpDestinationLargeCommunityList(491) which group of prefixes
          accumulated at which node how much delay.</t>

          <t>With destinationIPv4Address(13), destinationTransportPort(11),
          protocolIdentifier (4) and sourceIPv4Address(IE8), the forwarding
          path delay on each node from each IPv4 source address to a specific
          application in the network.</t>
        </list></t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document requests IANA to create new IEs (see table 1) and
      assign the following initial code points.</t>

      <t><figure>
          <artwork><![CDATA[

     +-------+-------------------------------+
     |Element|             Name              |
     |   ID  |                               |
     +-------+-------------------------------+
     | TBD1  | PathDelayMinDeltaMicroseconds |
     |       |                               |
     +-------+-------------------------------+
     | TBD2  | PathDelayMinDeltaNanoseconds  |
     |       |                               |
     +-------+-------------------------------+
     | TBD3  | PathDelayMaxDeltaMicroseconds |
     |       |                               |
     +-------+-------------------------------+
     | TBD4  | PathDelayMaxDeltaNanoseconds  |
     |       |                               |
     +-------+-------------------------------+
     | TBD5  | PathDelaySumDeltaMicroseconds |
     |       |                               |
     +-------+-------------------------------+
     | TBD6  | PathDelaySumDeltaNanoseconds  |
     |       |                               |
     +-------+-------------------------------+

  Table 1: Creates IEs in the "IPFIX Information Elements" registry
       ]]></artwork>
        </figure></t>

      <t>Note to the RFC-Editor:</t>

      <t><list style="symbols">
          <t>Please replace TBD1 - TBD6 with the values allocated by IANA</t>

          <t>Please replace the [RFC-to-be] with the RFC number assigned to
          this document</t>
        </list></t>

      <section anchor="IANAPathDelayMinDeltaMicroseconds"
               title="PathDelayMinDeltaMicroseconds">
        <t>Name: PathDelayMinDeltaMicroseconds <vspace blankLines="0"/>
        ElementID: TBD1 <vspace blankLines="0"/> Description: This Information
        Element identifies the lowest path delay in microseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned16 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>

      <section anchor="IANAPathDelayMinDeltaNanoseconds"
               title="PathDelayMinDeltaNanoseconds">
        <t>Name: PathDelayMinDeltaNanoseconds <vspace blankLines="0"/>
        ElementID: TBD2 <vspace blankLines="0"/> Description: This Information
        Element identifies the lowest path delay in nanoseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned32 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>

      <section anchor="IANAPathDelayMaxDeltaMicroseconds"
               title="PathDelayMaxDeltaMicroseconds">
        <t>Name: PathDelayMaxDeltaMicroseconds <vspace blankLines="0"/>
        ElementID: TBD3 <vspace blankLines="0"/> Description: This Information
        Element identifies the highest path delay in microseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned16 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>

      <section anchor="IANAPathDelayMaxDeltaNanoseconds"
               title="PathDelayMaxDeltaNanoseconds">
        <t>Name: PathDelayMaxDeltaNanoseconds <vspace blankLines="0"/>
        ElementID: TBD4 <vspace blankLines="0"/> Description: This Information
        Element identifies the highest path delay in nanoseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned32 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>

      <section anchor="IANAPathDelaySumDeltaMicroseconds"
               title="PathDelaySumDeltaMicroseconds">
        <t>Name: PathDelaySumDeltaMicroseconds <vspace blankLines="0"/>
        ElementID: TBD5 <vspace blankLines="0"/> Description: This Information
        Element identifies the sum of the path delay in microseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned32 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>

      <section anchor="IANAPathDelaySumDeltaNanoseconds"
               title="PathDelaySumDeltaNanoseconds">
        <t>Name: PathDelaySumDeltaNanoseconds <vspace blankLines="0"/>
        ElementID: TBD6 <vspace blankLines="0"/> Description: This Information
        Element identifies the sum of the path delay in nanoseconds. <vspace
        blankLines="0"/> Abstract Data Type: unsigned64 <vspace
        blankLines="0"/> Data Type Semantics: OctedDelta <vspace
        blankLines="0"/> Reference: [RFC-to-be], xxx</t>
      </section>
    </section>

    <section anchor="Operational" title="Operational Considerations">
      <section anchor="OpsTimeAccuracy" title="Time Accuracy">
        <t>The same recommondation as defined in section 4.5 of <xref
        target="RFC5153"/> for IPFIX apply in terms of clock precision to this
        document as well.</t>
      </section>

      <section anchor="OpsAverageDelay" title="Average Delay">
        <t>The average path delay can be calculated by dividing the
        PathDelaySumDeltaMicroseconds(TBD5) or
        PathDelaySumDeltaNanoseconds(TBD6) by the packetDeltaCount(2) at the
        IPFIX data collection.</t>
      </section>

      <section anchor="OpsIoamPackTimestamps" title="IOAM Packet Time Stamps">
        <t>For IOAM, Section 4.4.1 of <xref target="RFC9197"/>describes what
        kind of timestamps are supported. Section 4.4.2.3 and 4.4.2.4 describe
        where the timestamp is being inserted.</t>

        <t>For Path Tracing, Section 4.1 of <xref
        target="I-D.filsfils-spring-path-tracing"/> describes what kind of
        timestamps are supported. Section 9.2 describe the SRH path tracing
        TLV where the timestamp is being inserted.</t>
      </section>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>There are no significant extra security considerations regarding
      the allocation of these new IPFIX IEs compared to <xref
      target="RFC7012"/>.</t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>The authors would like to thank xxx for their review and valuable
      comments.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include='reference.RFC.7012'?>
    </references>

    <references title="Informative References">
      <?rfc include='reference.I-D.ietf-ippm-ioam-deployment'?>

      <?rfc include='reference.I-D.filsfils-spring-path-tracing'?>

      <?rfc include='reference.I-D.song-opsawg-ifit-framework'?>

      <?rfc include='reference.RFC.5153'?>

      <?rfc include='reference.I-D.tgraf-opsawg-ipfix-srv6-srh'?>

      <?rfc include='reference.RFC.7015'?>

      <?rfc include='reference.RFC.9197'?>
    </references>
  </back>
</rfc>
